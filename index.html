<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>COSA NOSTRA - MONITOR</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 50px; }
        .monitor { border: 2px solid #0f0; display: inline-block; padding: 30px; border-radius: 15px; box-shadow: 0 0 20px #0f0; }
        #contador { font-size: 100px; display: block; margin: 10px 0; }
        .info { font-size: 12px; color: #0a0; text-transform: uppercase; letter-spacing: 2px; }
        #detalhes { margin-top: 15px; font-size: 14px; color: #fff; }
    </style>
</head>
<body>

    <div class="monitor">
        <div class="info">Cosa Nostra Intelligence</div>
        <span id="contador">0</span>
        <div class="info">Dispositivos Ativos</div>
        <div id="detalhes">Aguardando sinal...</div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const chave = params.get('key');

        async function buscarDados() {
            if (!chave) {
                document.body.innerHTML = "<h1>ERRO: CHAVE AUSENTE NA URL</h1>";
                return;
            }

            try {
                // O t=Date.now() serve para o navegador não usar o "zero" que está na memória
                const resp = await fetch(`/api?key=${chave}&t=${Date.now()}`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const dados = await resp.json();

                if (Array.isArray(dados)) {
                    const total = dados.length;
                    document.getElementById('contador').innerText = total;
                    
                    if (total > 0) {
                        document.getElementById('contador').style.color = "#f00"; // Fica vermelho se detectar
                        document.getElementById('detalhes').innerText = "ALVO LOCALIZADO NA REDE";
                    } else {
                        document.getElementById('contador').style.color = "#0f0";
                        document.getElementById('detalhes').innerText = "Nenhum sinal detectado...";
                    }
                }
            } catch (e) {
                console.error("Falha na sincronização");
            }
        }

        // Atualiza a cada 3 segundos
        setInterval(buscarDados, 3000);
        buscarDados();
    </script>
</body>
</html>
