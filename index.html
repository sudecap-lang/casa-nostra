<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>COSA NOSTRA - NETWORK INTELLIGENCE</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding-top: 50px; }
        .monitor { border: 2px solid #0f0; display: inline-block; padding: 20px; border-radius: 10px; box-shadow: 0 0 15px #0f0; }
        #contador { font-size: 80px; font-weight: bold; display: block; }
        .status { color: #0a0; margin-top: 10px; font-size: 12px; }
        #lista { margin-top: 20px; text-align: left; display: inline-block; }
    </style>
</head>
<body>

    <div class="monitor">
        <h2 style="margin: 0;">COSA NOSTRA</h2>
        <small>NETWORK INTELLIGENCE V7.0</small>
        <hr style="border: 0.5px solid #0f0; margin: 20px 0;">
        
        <span id="contador">0</span>
        <div class="status">SINCRO-ESTÁVEL // LINK CRIPTOGRAFADO</div>
        
        <div id="lista"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const key = urlParams.get('key');

        async function atualizarDados() {
            if (!key) {
                document.body.innerHTML = "<h1>ACESSO NEGADO: CHAVE AUSENTE</h1>";
                return;
            }

            try {
                // Adicionamos um timestamp (t=...) para forçar o navegador a não usar cache
                const response = await fetch(`/api?key=${key}&t=${Date.now()}`);
                const dados = await response.json();

                if (Array.isArray(dados)) {
                    const total = dados.length;
                    document.getElementById('contador').innerText = total;
                    
                    let htmlLista = "";
                    dados.forEach(item => {
                        htmlLista += `<div>[+] ALVO DETECTADO: ${item.mac}</div>`;
                    });
                    document.getElementById('lista').innerHTML = htmlLista;
                    
                    // Se houver 1 ou mais, muda a cor para alerta
                    document.getElementById('contador').style.color = total > 0 ? "#f00" : "#0f0";
                }
            } catch (err) {
                console.error("Erro ao buscar dados:", err);
            }
        }

        // Atualiza a cada 5 segundos
        setInterval(atualizarDados, 5000);
        atualizarDados();
    </script>
</body>
</html>
