<script>
    const urlParams = new URLSearchParams(window.location.search);
    const chaveAcesso = urlParams.get('key'); // Pega o 1234 da URL

    async function atualizar() {
        if (!chaveAcesso) {
            document.getElementById('msg').innerText = "ERRO: CHAVE AUSENTE";
            return;
        }

        try {
            // O t=Date.now garante que o navegador não use dados velhos do cache
            const res = await fetch(`/api?key=${chaveAcesso}&t=${Date.now()}`);
            const dados = await res.json();
            
            const total = Array.isArray(dados) ? dados.length : 0;
            document.getElementById('contador').innerText = total;
            
            if (total > 0) {
                document.getElementById('msg').innerText = "ALVO DETECTADO NA REDE";
                document.getElementById('contador').style.color = "#f00";
            } else {
                document.getElementById('msg').innerText = "NENHUM ALVO NA REDE";
                document.getElementById('contador').style.color = "#0f0";
            }
        } catch (e) {
            console.error("Falha na sincronização");
        }
    }

    setInterval(atualizar, 3000);
    atualizar();
</script>
