<script>
    const params = new URLSearchParams(window.location.search);
    const chave = params.get('key');

    async function monitorar() {
        if (!chave) return;
        try {
            // O t=Date.now() obriga o navegador a buscar o dado real no banco
            const r = await fetch(`/api?key=${chave}&t=${Date.now()}`);
            const d = await r.json();
            
            // Se d for uma lista, d.length será 1 (conforme seu terminal mostra)
            const total = Array.isArray(d) ? d.length : 0;
            
            const el = document.getElementById('contador');
            el.innerText = total;
            
            // Muda a cor se detectar algo
            el.style.color = total > 0 ? "#ff0000" : "#00ff00";
        } catch (e) {
            console.error("Erro de conexão");
        }
    }

    setInterval(monitorar, 3000);
    monitorar();
</script>
